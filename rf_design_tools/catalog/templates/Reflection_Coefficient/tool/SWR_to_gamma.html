{% extends "base_generic.html" %}
{% load static %}
{% block content %}
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.3.2/math.js"></script>
</head>

<!-- SWR to reflection coefficient -->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-4">
          <h2 class="tool-name">SWR to |&#915;| and S<sub>11</sub></h2>
        </div>
    </div>

    <div class="row">
      <div class="col-md-auto">
      <div class="mx-auto box_form">
        <!-- Instantiate the form -->
        <form method="POST"> 
          {% csrf_token %}          
          <table class="table table-bordered table-hover">
            <thead>
              <tr>
                <th>Parameter</th>
                <th>Value</th>
              </tr>
            </thead>
            <tbody>
              <tr> <!--gamma magnitude -->
                <td>
                  SWR
                </td>
                <td>
                  <input type="number" id="SWR" step = '0.1' min='1' value="1.3" style="width: 5em" onchange="calculate()">
                </td>
              </tr>
            </tbody>
          </table>

          <!-- BUTTONS -->
          <div class="d-flex flex-row justify-content-center">
            <div class="p-2">
              <a href="{% url 'reflection_coeff_docs' %}" class="btn btn-info" role="button">See docs</a>
            </div>
          </div> 
          </form>
      </div>
    </div>

    <div class="col-md-auto">
      <div class="mx-auto">
            <!-- Present the result -->
              <div class="card-body">
                    <table class="table table-light table-bordered table-striped">
                      <thead>
                        <tr>
                          <th colspan="2"><h5 align="center">Results</h5></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr> 
                          <td>&#124;&#915;&#124</td>
                          <td align="center"><p id="gamma"> </p></td>
                        </tr>
                        <tr> 
                          <td>S<sub>11</sub></td>
                          <td align="center"><p id="S11"> </p></td>
                        </tr>
                      </tbody>
                    </table>
              </div>
            </div>
      </div>
  </div>
  </div>

  <script type="text/javascript">
    calculate()
    function calculate(){
      // Get data
      let SWR = parseFloat(document.getElementById("SWR").value)
      let S11 = '-' + '&#8734';
      
      // Calculations
      let gamma_mag = (SWR-1)/(SWR+1);
      if (gamma_mag > 1e-3)
      {
          S11 = 20*math.log10(gamma_mag)
          S11 = S11.toFixed(2)
      }
      
      // Put results inside the table
      document.getElementById("gamma").innerHTML = gamma_mag.toFixed(2)
      document.getElementById("S11").innerHTML = S11 + " dB"
                
    }
  </script>

{% endblock %}
