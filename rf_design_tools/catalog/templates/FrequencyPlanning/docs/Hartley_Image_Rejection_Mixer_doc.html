{% extends "base_generic.html" %}
{% load static %}
{% block content %}

<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<div class="card shadow-sm">

   <div class="row">
        <div class="col-6 align-self-right">
            <h1 style = "margin: 0.5cm 0.4cm 0.5cm; vertical-align: middle;">Hartley Image Rejection Mixer</h1>
        </div>
    
        <div class="col-6 align-self-center text-right">
            <div class=”card card-inverse card-danger”>
                <a href="{% url 'image_frequency_planning' %}" class="btn btn-dark" role="button">f<sub>IM</sub> Tool</a>
            </div>
        </div>
    </div>


    <div class= "d-flex flex-row justify-content-center">
        <div class="thumbnail" align="center">
            <img class="img-responsive" src="{% static 'images/image_frequency/Hartley_Architecure.png' %}" style="width:50%" alt="HartleyArchitecture">
            <div class="caption">
                <p>Fig. 1: Hartley architecture block diagram</p>
            </div>
        </div>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>
            Assume that the incoming signal is the sum of the desired signal and the image frequency:
        </p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$  v_{ RF }( t ) = V_{ SIG } · cos( \omega_{SIG} · t  ) + V_{IM } · cos( \omega_{IM} · t  ) \tag{1} $$</p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>
            The incoming signal is downconverted to IF and low-pass filtered to remove the higher frequency components 
            generated by the downconversion. Thus, since the mixer acts as a time domain multiplication, the IF waveforms at A and B are:
        </p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$  IF_A( t ) = { { A_{SIG} } \over { 2 } } · cos( (\omega_{SIG} - \omega_{LO}) · t ) + { { A_{IM} } \over { 2 } } · cos( (\omega_{LO} - \omega_{IM}) · t ) \tag{2} $$</p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$ IF_B( t ) = -{ A_{SIG}  \over  2 } · sin( (\omega_{SIG} - \omega_{LO}) · t ) + { A_{IM} \over  2 } · sin( (\omega_{LO} - \omega_{IM}) · t )  \tag{3} $$</p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>
            Provided that sin(&#945;) = cos(&#945; – &#960;/2):
        </p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$ IF_B( t ) = -{ A_{SIG} \over  2 } · cos( (\omega_{SIG} - \omega_{LO}) · t - {\pi \over 2} ) + { A_{IM} \over 2 } · cos( (\omega_{LO} - \omega_{IM}) · t - {\pi \over 2} ) \tag{4} $$</p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>
            The lower branch, B, is 90&#176; phase shifted, so at the output we get:
        </p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$ IF_C( t ) = -{ A_{SIG} \over 2 } · cos( (\omega_{SIG} - \omega_{LO}) · t - \pi) + { A_{IM} \over 2 } · cos( (\omega_{LO} - \omega_{IM}) · t - \pi) \tag{5} $$</p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$ IF_C( t ) = { A_{SIG} \over 2 } · cos( (\omega_{SIG} - \omega_{LO}) · t)- { A_{IM} \over 2 } · cos( (\omega_{LO} - \omega_{IM}) · t ) \tag{6} $$</p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>
            At the output, the voltage waveforms IF<sub>A</sub>(t) and IF<sub>C</sub>(t) are added, so we get:
        </p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$ IF_{ OUT }( t ) = IF_A( t ) + IF_C( t ) = A_{SIG} · cos( (\omega_{SIG} - \omega_{LO}) · t )   \tag{7} $$</p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>
            As seen, the sum cancels out the signal from the image frequency.
        </p>
    </div>

    <div class="col-6 align-self-right">
        <h5>Image Rejection vs Circuit Impairments</h5>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>
            The image cancellation relies on the perfect symmetry of the circuit. In practice, the image rejection is usually about 35dB (without dynamic calibration).
             In order to quantify this effect, we may express the LO waveforms as follows:
        </p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>Lower mixer: </p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        
        <p> $$LO_1 = sin( \omega_{LO} · t ) \tag{8} $$</p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>Upper mixer: </p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$ LO_2 = (1 + \epsilon)sin( \omega_{LO} · t + \Delta·\theta ) \tag{9} $$</p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>where the lower mixer shows amplitude (&#949;) and phase (&#916;&#920;) impairments. </p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>Under the assumption that the received signal has the form:</p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$ V_{RF}( t ) = A_{SIG} · cos( \omega_{RF} · t + \phi_{SIG}) + A_{IM} · cos ( \omega_{IM} · t + \phi_{IM} ) \tag{10} $$</p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>The voltage waveform at A (see Fig. 1) is:</p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$ IF_A( t ) = { A_{SIG} \over 2} · ( 1 + \epsilon ) · cos( (\omega_{RF} - \omega_{LO})· t + \phi_{SIG} + \Delta · \theta  ) + { A_{IM} \over 2} · ( 1 + \epsilon ) · cos( (\omega_{IM} - \omega_{LO})· t + \phi_{IM} + \Delta·\theta  ) \tag{11} $$</p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>
            whereas the waveform at B and is still the same as in Eqs. (5) and (6)
        </p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>
            At the end of the mixer, we have the sum of the xA(t) and xC(t) voltages (see Eq. (12)). We see that the local oscillator impairment affects both to the desired signal and the image.
        </p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$  IF_{OUT}(t) =  \color {blue} {x_{SIG}( t )}  + \color {red} {x_{IM}( t )} =  $$</p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$  = \color {blue} { {A_{SIG} \over 2} · ( 1 + \epsilon ) · cos( (\omega_{RF} - \omega_{LO}) · t  + \phi_{SIG} + \Delta·\theta) + {A_{SIG} \over 2} · cos( (\omega_{RF} - \omega_{LO} ) · t + \phi_{SIG} )}  + $$</p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$ + \color {red} { {A_{IM} \over 2} · (1 + \epsilon) · cos( (\omega_{IM} - \omega_{LO}) · t + \phi_{IM} + \Delta·\theta) - { A_{IM} \over 2} · cos( (\omega_{IM} - \omega_{LO}) · t + \phi_{IM}) } \tag{12} $$</p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>
            In order to quantify the image rejection, we define the image rejection ratio (IRR) 
            as the ratio of the power of the signal and the image at the output of the mixer.
             From Eq. (12), we use the following expression to calculate the average power:
        </p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$  \langle a·cos(\omega · t + \alpha) + b · cos(\omega · t) \rangle = { {a^2 + 2 · a · b · cos(\alpha)  + b^2} \over 2} \tag{13} $$</p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>
            Using Eq. (13), the average power of the desired signal is given by:
        </p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$  x_{SIG}( t )  = {A_{SIG} \over 2} · ( 1 + \epsilon ) · cos( (\omega_{RF} - \omega_{LO}) · t  + \phi_{SIG} + \Delta·\theta) + {A_{SIG} \over 2} · cos( (\omega_{RF} - \omega_{LO}) · t + \phi_{SIG} ) $$</p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$ \Longrightarrow 
            P_{sig}^{average} = { {A_{SIG}^2 · (1 + \epsilon)^2} \over 4^2}  + 2 · { {A_{SIG}^2 · (1 + \epsilon)} \over 4^2} · cos( \Delta·\theta ) + {A_{SIG}^2 \over 4^2} \tag{14} $$</p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>
            Similarly, for the contribution coming from the image frequency:
        </p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$ x_{IM}( t ) =  {A_{IM} \over 2} · (1 + \epsilon) · cos( (\omega_{IM} - \omega_{LO}) · t + \phi_{IM} + \Delta·\theta) - { A_{IM} \over 2} · cos( (\omega_{IM} - \omega_{LO}) · t + \phi_{IM})$$</p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$  \Longrightarrow  P_{IM}^{average} = { { A_{SIG}^2 · (1 + \epsilon)^2 } \over 4^2} - 2 · { { A_{SIG}^2 · (1 + \epsilon) } \over 4^2} + {A_{SIG}^2 \over 4^2} \tag{15} $$</p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>
            Since the IRR is the ratio between the signal and the image signals, we have:
        </p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$ IRR^{n.u.)} = {P_{SIG}^{average} \over P_{IM}^{average} } = {A_{SIG}^2 \over A_{IM}^2}· { (1 + \epsilon)^2 +  (1 + \epsilon)·cos(\Delta·\theta) + 1  \over  (1 + \epsilon)^2 -  (1 + \epsilon)·cos(\Delta · \theta) + 1 } \tag{16} $$</p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <p> $$ IRR = 10·log_{10} \left( {A_{SIG}^2 \over A_{IM}^2}· { (1 + \epsilon)^2 +  (1 + \epsilon)·cos(\Delta·\theta) + 1  \over  (1 + \epsilon)^2 -  (1 + \epsilon)·cos(\Delta · \theta) + 1 } \right) \tag{17} $$</p>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>
            At the light of Eqs. (16) and (17), it is possible to calculate the IRR in terms of the amplitude 
            and the phase mismatches of the LO signal [1]. Fig 2 plots Eq (17) for different values of &#949; and &#916;&#952;
             and it shows that the mismatch between the LO waveforms should be near &#960; /30 (6&#176;) for achieving a IRR = 25dB
        </p>
    </div>

    <div class= "d-flex flex-row justify-content-center">
        <div class="thumbnail" align="center">
            <img class="img-responsive" src="{% static 'images/image_frequency/IRR_Hartley.png' %}" style="width:50%" alt="HartleyArchitecture">
            <div class="caption">
                <p>Fig. 2: IRR vs amplitude and phase LO mismatch</p>
            </div>
        </div>
    </div>

    <div class="col-6 align-self-right">
        <h5>See also</h5>
    </div>

    <ul class="list-group">
        <li class="list-group-item"><a href="{% url 'image_frequency_planning_docs' %}" >Image frequency notes</a></li>
        <li class="list-group-item"><a href="{% url 'weaver_irm_docs' %}" >Weaver Image Rejection Mixer</a></li>
        <li class="list-group-item"><a href="{% url 'ssb_mixer_notes' %}" >SSB Mixer</a></li>
      </ul>

    <div class="col-6 align-self-right">
        <h5>References</h5>
    </div>

    <div class= "d-flex flex-row" style = "margin: 0cm 0.4cm 0.2cm;">
        <p>[1] Behzad Razavi, RF microelectronics, 2011</p>
    </div>
    
  </div>
</main>
{% endblock %}